{% extends "base.html" %}

{% block title %}Daftar - Rental Mobil{% endblock %}

{% block content %}
<div class="container py-5">
    <div class="row justify-content-center">
        <div class="col-md-8">
            <div class="card border-0 shadow">
                <div class="card-body p-5">
                    <div class="text-center mb-4">
                        <h1 class="h2 fw-bold text-primary">Daftar Akun Baru</h1>
                        <p class="text-muted">Isi data diri Anda untuk membuat akun</p>
                    </div>

                    <form method="POST" action="{{ url_for('register') }}" id="registerForm">
                        <div class="row">
                            <!-- Personal Information -->
                            <div class="col-md-6">
                                <h5 class="mb-3 text-primary">Informasi Pribadi</h5>
                                
                                <div class="mb-3">
                                    <label for="nama" class="form-label">Nama Lengkap</label>
                                    <div class="input-group">
                                        <span class="input-group-text"><i class="fas fa-user"></i></span>
                                        <input type="text" class="form-control" id="nama" name="nama" required 
                                               placeholder="Nama lengkap sesuai KTP">
                                    </div>
                                </div>

                                <div class="mb-3">
                                    <label for="nik" class="form-label">NIK</label>
                                    <div class="input-group">
                                        <span class="input-group-text"><i class="fas fa-id-card"></i></span>
                                        <input type="text" class="form-control" id="nik" name="nik" required 
                                               placeholder="16 digit NIK" maxlength="16" minlength="16">
                                    </div>
                                    <div class="form-text">Harus 16 digit angka</div>
                                </div>

                                <div class="mb-3">
                                    <label for="tanggal_lahir" class="form-label">Tanggal Lahir</label>
                                    <div class="input-group">
                                        <span class="input-group-text"><i class="fas fa-birthday-cake"></i></span>
                                        <input type="date" class="form-control" id="tanggal_lahir" name="tanggal_lahir" required>
                                    </div>
                                </div>

                                <div class="mb-3">
                                    <label for="no_telepon" class="form-label">No. Telepon</label>
                                    <div class="input-group">
                                        <span class="input-group-text"><i class="fas fa-phone"></i></span>
                                        <input type="tel" class="form-control" id="no_telepon" name="no_telepon" required 
                                               placeholder="0812-3456-7890">
                                    </div>
                                </div>
                            </div>

                            <!-- Account Information -->
                            <div class="col-md-6">
                                <h5 class="mb-3 text-primary">Informasi Akun</h5>

                                <div class="mb-3">
                                    <label for="email" class="form-label">Email</label>
                                    <div class="input-group">
                                        <span class="input-group-text"><i class="fas fa-envelope"></i></span>
                                        <input type="email" class="form-control" id="email" name="email" required 
                                               placeholder="nama@contoh.com">
                                    </div>
                                </div>

                                <div class="mb-3">
                                    <label for="password" class="form-label">Password</label>
                                    <div class="input-group">
                                        <span class="input-group-text"><i class="fas fa-lock"></i></span>
                                        <input type="password" class="form-control" id="password" name="password" required 
                                               placeholder="Minimal 6 karakter">
                                        <button class="btn btn-outline-secondary" type="button" id="togglePassword">
                                            <i class="fas fa-eye"></i>
                                        </button>
                                    </div>
                                </div>

                                <div class="mb-3">
                                    <label for="confirm_password" class="form-label">Konfirmasi Password</label>
                                    <div class="input-group">
                                        <span class="input-group-text"><i class="fas fa-lock"></i></span>
                                        <input type="password" class="form-control" id="confirm_password" name="confirm_password" required 
                                               placeholder="Ketik ulang password">
                                        <button class="btn btn-outline-secondary" type="button" id="toggleConfirmPassword">
                                            <i class="fas fa-eye"></i>
                                        </button>
                                    </div>
                                    <div id="passwordMatch" class="form-text"></div>
                                </div>

                                <div class="mb-3">
                                    <label for="alamat" class="form-label">Alamat</label>
                                    <div class="input-group">
                                        <span class="input-group-text"><i class="fas fa-home"></i></span>
                                        <textarea class="form-control" id="alamat" name="alamat" rows="3" required 
                                                  placeholder="Alamat lengkap"></textarea>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Terms and Conditions -->
                        <div class="mb-4">
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" id="terms" name="terms" required>
                                <label class="form-check-label" for="terms">
                                    Saya setuju dengan 
                                    <a href="#" class="text-primary text-decoration-none">Syarat dan Ketentuan</a> 
                                    dan 
                                    <a href="#" class="text-primary text-decoration-none">Kebijakan Privasi</a>
                                </label>
                            </div>
                        </div>

                        <div class="d-grid gap-2">
                            <button type="submit" class="btn btn-primary btn-lg">
                                <i class="fas fa-user-plus me-2"></i> Daftar Akun
                            </button>
                        </div>

                        <div class="text-center mt-3">
                            <p class="mb-0">Sudah punya akun? 
                                <a href="{{ url_for('login') }}" class="text-primary fw-bold text-decoration-none">
                                    Login di sini
                                </a>
                            </p>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
// Toggle password visibility
function setupPasswordToggle(inputId, buttonId) {
    const button = document.getElementById(buttonId);
    const input = document.getElementById(inputId);
    
    button.addEventListener('click', function() {
        const type = input.getAttribute('type') === 'password' ? 'text' : 'password';
        input.setAttribute('type', type);
        this.querySelector('i').classList.toggle('fa-eye');
        this.querySelector('i').classList.toggle('fa-eye-slash');
    });
}

// Setup both password toggles
setupPasswordToggle('password', 'togglePassword');
setupPasswordToggle('confirm_password', 'toggleConfirmPassword');

// Check password match
function checkPasswordMatch() {
    const password = document.getElementById('password').value;
    const confirmPassword = document.getElementById('confirm_password').value;
    const matchDiv = document.getElementById('passwordMatch');
    
    if (password && confirmPassword) {
        if (password === confirmPassword) {
            matchDiv.innerHTML = '<span class="text-success"><i class="fas fa-check-circle"></i> Password cocok</span>';
            return true;
        } else {
            matchDiv.innerHTML = '<span class="text-danger"><i class="fas fa-times-circle"></i> Password tidak cocok</span>';
            return false;
        }
    }
    return null;
}

// Real-time password match checking
document.getElementById('password').addEventListener('input', checkPasswordMatch);
document.getElementById('confirm_password').addEventListener('input', checkPasswordMatch);

// NIK validation
document.getElementById('nik').addEventListener('input', function(e) {
    this.value = this.value.replace(/[^0-9]/g, '');
    if (this.value.length > 16) {
        this.value = this.value.slice(0, 16);
    }
});

// Form validation
document.getElementById('registerForm').addEventListener('submit', function(e) {
    // Check password match
    if (!checkPasswordMatch()) {
        e.preventDefault();
        alert('Password tidak cocok!');
        return false;
    }
    
    // Check NIK length
    const nik = document.getElementById('nik').value;
    if (nik.length !== 16) {
        e.preventDefault();
        alert('NIK harus 16 digit!');
        return false;
    }
    
    // Check password length
    const password = document.getElementById('password').value;
    if (password.length < 6) {
        e.preventDefault();
        alert('Password minimal 6 karakter!');
        return false;
    }
    
    // Check terms
    const terms = document.getElementById('terms').checked;
    if (!terms) {
        e.preventDefault();
        alert('Anda harus menyetujui syarat dan ketentuan!');
        return false;
    }
    
    return true;
});

// Set max date for birth date (18 years ago)
const today = new Date();
const maxDate = new Date(today.getFullYear() - 18, today.getMonth(), today.getDate());
document.getElementById('tanggal_lahir').max = maxDate.toISOString().split('T')[0];
</script>
{% endblock %}